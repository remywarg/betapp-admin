<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>BetApp • Admin</title>
  <meta name="theme-color" content="#0b0b0c" />

  <style>
    :root{
      --bg:#070708;
      --panel: rgba(25,25,27,.78);
      --panel2: rgba(35,35,38,.72);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.58);
      --muted2: rgba(255,255,255,.42);
      --btn: rgba(255,255,255,.10);
      --btnHover: rgba(255,255,255,.14);
      --danger: rgba(255,90,90,.92);
      --ok: rgba(120,255,180,.85);
      --shadow: 0 28px 90px rgba(0,0,0,.55);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui;
      background: radial-gradient(1100px 700px at 50% 25%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(180deg, var(--bg), #000);
      color: var(--text);
      overflow-x:hidden;
    }

    /* Shared layout (same as dashboard) */
    .layout{ min-height:100vh; display:grid; grid-template-columns: 280px 1fr; }

    .sidebar{
      position:sticky; top:0; height:100vh;
      padding: 18px 14px calc(18px + env(safe-area-inset-bottom));
      border-right: 1px solid rgba(255,255,255,.08);
      background: rgba(10,10,11,.55);
      backdrop-filter: blur(18px);
    }

    .brand{
      display:flex; align-items:center; justify-content:center;
      height:56px; margin: 6px 0 16px; user-select:none;
    }
    .logo{
      width:140px; height:48px; object-fit:contain; display:block;
      visibility:hidden;
    }

    .nav{ display:flex; flex-direction:column; gap:6px; margin-top:10px; }
    .nav a{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:14px;
      text-decoration:none; color: rgba(255,255,255,.82);
      border:1px solid transparent; background:transparent;
      font-size:14px; font-weight:500;
    }
    .nav a:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.08); }
    .nav a.active{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.10); }
    .dot{ width:7px; height:7px; border-radius:99px; background: rgba(255,255,255,.35); }
    .nav a.active .dot{ background: rgba(255,255,255,.78); }

    .spacer{ flex:1; }
    .logout{
      margin-top:14px; width:100%;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.82);
      font-size:14px; font-weight:500;
      cursor:pointer;
    }
    .logout:hover{ background: rgba(255,255,255,.10); }

    .overlay{
      display:none; position:fixed; inset:0;
      background: rgba(0,0,0,.55); z-index: 20;
    }
    .overlay.open{ display:block; }

    .main{ padding:18px 18px calc(18px + env(safe-area-inset-bottom)); }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px; }
    .title{ font-size:18px; font-weight:650; margin:0; letter-spacing:.2px; }
    .subtitle{ margin-top:4px; font-size:13px; color: var(--muted); font-weight:500; }

    .mobileBtn{
      display:none;
      padding:9px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.84);
      font-size:14px; font-weight:500;
      cursor:pointer;
    }

    /* Content cards */
    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      padding: 16px;
    }

    .row2{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
      margin-top: 12px;
      align-items:start;
    }

    .segTitle{
      font-size: 13px;
      font-weight: 650;
      margin: 0 0 10px;
      color: rgba(255,255,255,.86);
    }

    label{
      display:block;
      font-size: 12.5px;
      color: var(--muted2);
      margin: 0 0 6px;
    }

    .input, .textarea, .select{
      width:100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.08);
      color: var(--text);
      outline:none;
      font-size: 14px;
      font-weight: 500;
    }
    .textarea{ min-height: 110px; resize: vertical; }
    .hintRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top: 6px;
      color: rgba(255,255,255,.45);
      font-size: 12px;
      font-weight: 500;
    }
    .dangerText{ color: rgba(255,120,120,.92); }

    /* iOS zoom engeli */
    @supports (-webkit-touch-callout:none){
      .input, .textarea, .select{ font-size:16px; }
      .hintRow{ font-size:12.5px; }
    }

    .tabs{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .tab{
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.82);
      font-size: 13px;
      font-weight: 500;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
    }

    .btnRow{
      display:flex;
      justify-content:flex-end;
      gap: 10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 9px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: var(--btn);
      color: rgba(255,255,255,.90);
      font-size: 14px;
      font-weight: 500;
      letter-spacing:.2px;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ background: var(--btnHover); }
    .btn:active{ transform: scale(.98); }
    .btn.secondary{ background: rgba(255,255,255,.06); }

    .note{
      margin-top: 10px;
      font-size: 12.5px;
      color: rgba(255,255,255,.55);
      line-height: 1.4;
    }

    /* Preview */
    .previewBox{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 14px;
    }
    .pTitle{ margin:0 0 6px; font-size: 13.5px; font-weight: 650; color: rgba(255,255,255,.92); }
    .pMsg{ margin:0; font-size: 13px; color: rgba(255,255,255,.74); line-height: 1.35; }

    /* Modal */
    .modalWrap{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modalWrap.open{ display:flex; }
    .modalBg{
      position:absolute; inset:0;
      background: rgba(0,0,0,.65);
    }
    .modal{
      position:relative;
      width:100%;
      max-width: 520px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      padding: 16px;
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .modalTitle{
      margin:0;
      font-size: 14px;
      font-weight: 650;
      color: rgba(255,255,255,.90);
    }
    .xBtn{
      border:none;
      background: transparent;
      color: rgba(255,255,255,.60);
      font-size: 20px;
      cursor:pointer;
      padding: 4px 10px;
      border-radius: 10px;
    }
    .xBtn:hover{ background: rgba(255,255,255,.06); }

    .alert{
      margin-top: 10px;
      display:none;
      font-size: 13px;
      line-height: 1.35;
      color: rgba(255,255,255,.72);
    }
    .alert.err{ color: var(--danger); }
    .alert.ok{ color: var(--ok); }

    /* Mobile */
    @media (max-width: 920px){
      .layout{ grid-template-columns: 1fr; }
      .sidebar{
        position:fixed; inset:0 auto 0 0;
        width:280px;
        transform: translateX(-110%);
        transition: transform .18s ease;
        z-index:30;
      }
      .sidebar.open{ transform: translateX(0); }
      .mobileBtn{ display:inline-flex; }
      .row2{ grid-template-columns: 1fr; }
      .overlay.open{ display:block; }
      .main{ padding:16px 14px calc(16px + env(safe-area-inset-bottom)); }
    }
  </style>
</head>

<body>
  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <img id="brandLogo" class="logo" src="assets/logo.png?v=1" alt="" decoding="async" loading="eager">
      </div>

      <nav class="nav">
        <a href="dashboard.html"><span class="dot"></span> Dashboard</a>
        <a class="active" href="send.html"><span class="dot"></span> Bildirim Gönder</a>
        <a href="campaigns.html"><span class="dot"></span> Kampanyalar</a>
        <a href="users.html"><span class="dot"></span> Kullanıcılar</a>
        <a href="profile.html"><span class="dot"></span> Profil</a>
      </nav>

      <div class="spacer"></div>
      <button class="logout" id="logoutBtn">Çıkış Yap</button>
    </aside>

    <div class="overlay" id="overlay"></div>

    <main class="main">
      <div class="topbar">
        <div>
          <h1 class="title">Bildirim Gönder</h1>
          <div class="subtitle">Anında • Zamanlı • Test gönderim</div>
        </div>
        <button class="mobileBtn" id="menuBtn">Menü</button>
      </div>

      <div class="row2">
        <!-- Form -->
        <section class="card">
          <div class="segTitle">Gönderim türü</div>
          <div class="tabs" role="tablist" aria-label="Gönderim türü">
            <button class="tab active" id="tabNow"  type="button">Anında</button>
            <button class="tab" id="tabLater" type="button">Zamanlı</button>
            <button class="tab" id="tabTest"  type="button">Test</button>
          </div>

          <div class="group">
            <label for="titleInput">Başlık</label>
            <input class="input" id="titleInput" maxlength="40" placeholder="Kısa başlık">
            <div class="hintRow"><span></span><span id="titleCount">0 / 40</span></div>
          </div>

          <div class="group" style="margin-top:12px;">
            <label for="msgInput">Mesaj</label>
            <textarea class="textarea" id="msgInput" maxlength="120" placeholder="Bildirim mesajı"></textarea>
            <div class="hintRow"><span></span><span id="msgCount">0 / 120</span></div>
          </div>

          <!-- Zamanlı alan -->
          <div id="laterBox" style="display:none; margin-top:12px;">
            <label for="whenInput">Tarih & Saat</label>
            <input class="input" id="whenInput" type="datetime-local">
            <div class="note">Zamanlı kampanyalar gönderilmeden önce iptal edilebilir.</div>
          </div>

          <!-- Test alan -->
          <div id="testBox" style="display:none; margin-top:12px;">
            <label for="testUser">Test kullanıcı adı</label>
            <input class="input" id="testUser" placeholder="örn: admin1">
            <div class="note">Birden fazla kullanıcı için virgül ile ayırabilirsiniz: <span class="muted">admin1, admin2</span></div>
          </div>

          <div class="btnRow">
            <button class="btn secondary" id="btnPreview" type="button">Önizle</button>
            <button class="btn" id="btnSend" type="button">Gönder</button>
          </div>

          <div class="alert err" id="rateAlert">
            Çok sık gönderim yapıyorsunuz. Yeni kampanya için biraz bekleyin.
          </div>
          <div class="alert ok" id="okAlert">Kampanya kaydedildi. (Demo)</div>
        </section>

        <!-- Preview -->
        <aside class="card">
          <div class="segTitle">Önizleme</div>
          <div class="previewBox">
            <p class="pTitle" id="pTitle">Başlık</p>
            <p class="pMsg" id="pMsg">Mesaj</p>
          </div>
          <div class="note" id="previewNote">
            Gönderimden önce önizleme ve onay ekranı gösterilir.
          </div>
        </aside>
      </div>
    </main>
  </div>

  <!-- Confirm Modal -->
  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modalBg" id="modalBg"></div>
    <div class="modal" role="dialog" aria-modal="true" aria-label="Onay">
      <div class="modalHead">
        <h3 class="modalTitle">Gönderimi Onayla</h3>
        <button class="xBtn" id="modalClose" aria-label="Kapat">×</button>
      </div>

      <div class="previewBox">
        <p class="pTitle" id="mTitle">—</p>
        <p class="pMsg" id="mMsg">—</p>
      </div>

      <div class="note" id="mMeta"></div>

      <div class="btnRow" style="margin-top:12px;">
        <button class="btn secondary" id="btnCancel" type="button">Vazgeç</button>
        <button class="btn" id="btnConfirm" type="button">Onayla</button>
      </div>

      <div class="alert err" id="mErr" style="display:none;"></div>
      <div class="alert ok" id="mOk" style="display:none;">Gönderim başlatıldı. (Demo)</div>
    </div>
  </div>

  <script>
    // Auth guard (demo)
    if (localStorage.getItem("admin_demo_auth") !== "1") location.replace("index.html");

    // Logo
    const brandLogo = document.getElementById("brandLogo");
    brandLogo.addEventListener("load", () => brandLogo.style.visibility = "visible");
    brandLogo.addEventListener("error", () => brandLogo.style.visibility = "hidden");

    // Mobile menu
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const menuBtn = document.getElementById("menuBtn");
    function openMenu(){ sidebar.classList.add("open"); overlay.classList.add("open"); }
    function closeMenu(){ sidebar.classList.remove("open"); overlay.classList.remove("open"); }
    menuBtn.addEventListener("click", openMenu);
    overlay.addEventListener("click", closeMenu);

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("admin_demo_auth");
      location.replace("index.html");
    });

    // Tabs
    const tabNow = document.getElementById("tabNow");
    const tabLater = document.getElementById("tabLater");
    const tabTest = document.getElementById("tabTest");
    const laterBox = document.getElementById("laterBox");
    const testBox = document.getElementById("testBox");

    let mode = "now"; // now | later | test
    function setMode(m){
      mode = m;
      [tabNow, tabLater, tabTest].forEach(x => x.classList.remove("active"));
      laterBox.style.display = "none";
      testBox.style.display = "none";

      if(m==="now"){ tabNow.classList.add("active"); }
      if(m==="later"){ tabLater.classList.add("active"); laterBox.style.display = "block"; }
      if(m==="test"){ tabTest.classList.add("active"); testBox.style.display = "block"; }
      updateMetaNote();
    }
    tabNow.onclick  = () => setMode("now");
    tabLater.onclick= () => setMode("later");
    tabTest.onclick = () => setMode("test");

    // Inputs + counters + preview
    const titleInput = document.getElementById("titleInput");
    const msgInput   = document.getElementById("msgInput");
    const titleCount = document.getElementById("titleCount");
    const msgCount   = document.getElementById("msgCount");
    const pTitle = document.getElementById("pTitle");
    const pMsg   = document.getElementById("pMsg");

    function sync(){
      titleCount.textContent = `${titleInput.value.length} / 40`;
      msgCount.textContent   = `${msgInput.value.length} / 120`;
      pTitle.textContent = titleInput.value.trim() || "Başlık";
      pMsg.textContent   = msgInput.value.trim() || "Mesaj";
    }
    titleInput.addEventListener("input", sync);
    msgInput.addEventListener("input", sync);
    sync();

    function updateMetaNote(){
      const note = document.getElementById("previewNote");
      if(mode==="now") note.textContent = "Anında gönderim: onay sonrası hemen gönderilir.";
      if(mode==="later") note.textContent = "Zamanlı gönderim: seçtiğiniz tarih/saatte otomatik gönderilir.";
      if(mode==="test") note.textContent = "Test gönderim: sadece seçtiğiniz kullanıcılara gönderilir.";
    }
    updateMetaNote();

    // Rate limit (demo) - 10 dk
    const RATE_MS = 10 * 60 * 1000;
    const rateKey = "demo_last_send_at";
    const rateAlert = document.getElementById("rateAlert");
    const okAlert = document.getElementById("okAlert");

    function checkRate(){
      const last = Number(localStorage.getItem(rateKey) || "0");
      const now = Date.now();
      return (now - last) >= RATE_MS;
    }
    function setRateNow(){
      localStorage.setItem(rateKey, String(Date.now()));
    }

    // Modal
    const modalWrap = document.getElementById("modalWrap");
    const modalBg = document.getElementById("modalBg");
    const modalClose = document.getElementById("modalClose");
    const btnCancel = document.getElementById("btnCancel");
    const btnConfirm = document.getElementById("btnConfirm");
    const mTitle = document.getElementById("mTitle");
    const mMsg = document.getElementById("mMsg");
    const mMeta = document.getElementById("mMeta");
    const mErr = document.getElementById("mErr");
    const mOk = document.getElementById("mOk");

    function openModal(){
      mErr.style.display = "none";
      mOk.style.display = "none";
      modalWrap.classList.add("open");
      modalWrap.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      modalWrap.classList.remove("open");
      modalWrap.setAttribute("aria-hidden", "true");
    }
    modalBg.onclick = closeModal;
    modalClose.onclick = closeModal;
    btnCancel.onclick = closeModal;

    // Validate + prepare modal content
    function buildMeta(){
      if(mode==="now") return "Tür: Anında";
      if(mode==="later"){
        const when = document.getElementById("whenInput").value;
        return "Tür: Zamanlı" + (when ? ` • Zaman: ${when.replace("T"," ")}` : "");
      }
      if(mode==="test"){
        const u = document.getElementById("testUser").value.trim();
        return "Tür: Test" + (u ? ` • Kullanıcılar: ${u}` : "");
      }
      return "";
    }

    function validate(){
      const t = titleInput.value.trim();
      const m = msgInput.value.trim();
      if(!t || !m) return "Başlık ve mesaj zorunludur.";

      if(mode==="later"){
        const when = document.getElementById("whenInput").value;
        if(!when) return "Zamanlı gönderim için tarih ve saat seçmelisiniz.";
      }
      if(mode==="test"){
        const u = document.getElementById("testUser").value.trim();
        if(!u) return "Test gönderim için en az 1 kullanıcı adı yazmalısınız.";
      }
      return "";
    }

    document.getElementById("btnPreview").onclick = () => {
      const err = validate();
      if(err){
        okAlert.style.display = "none";
        rateAlert.style.display = "none";
        alert(err);
        return;
      }
      mTitle.textContent = titleInput.value.trim();
      mMsg.textContent = msgInput.value.trim();
      mMeta.textContent = buildMeta();
      openModal();
    };

    document.getElementById("btnSend").onclick = () => {
      const err = validate();
      if(err){
        okAlert.style.display = "none";
        rateAlert.style.display = "none";
        alert(err);
        return;
      }
      mTitle.textContent = titleInput.value.trim();
      mMsg.textContent = msgInput.value.trim();
      mMeta.textContent = buildMeta();
      openModal();
    };

    btnConfirm.onclick = async () => {
      mErr.style.display = "none";
      mOk.style.display = "none";
      rateAlert.style.display = "none";
      okAlert.style.display = "none";

      if(!checkRate()){
        mErr.textContent = "Çok sık gönderim yapıyorsunuz. Lütfen 10 dakika sonra tekrar deneyin.";
        mErr.style.display = "block";
        return;
      }

      // DEMO: burada API çağrısı olacak:
      // POST /api/admin/campaigns {type, title, msg, when?, testUsers?}
      setRateNow();
      mOk.style.display = "block";

      setTimeout(()=>{
        closeModal();
        okAlert.style.display = "block";
      }, 550);
    };
  </script>
</body>
</html>
